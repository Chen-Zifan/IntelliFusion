{% extends 'base.html' %}
<head>
{% block include %}
{{ super() }}
<title>Realizer</title>
{% endblock %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        $('#OpenAI').on('#sendInput', function(event) {
            event.preventDefault();
            var userInput = $('#user-input').val();
            var modelInput = $('#model-input').val();
            $.ajax({
                url: '/openai',
                type: 'POST',
                data: { user_input: userInput },
                success: function(response) {
                    var chatGptResponse = response.response;
                    $('#chat-output').append('<p><strong>You:</strong> ' + userInput + '</p>');
                    $('#chat-output').append('<p><strong>' + modelInput + '</strong> ' + chatGptResponse + '</p>');
                    $('#user-input').val('');
                }
            });
        });
    });
</script>
</head>
{% block body %}
<body>
<div class="main" id="main-box">
    <div id="contentwrap"  class="contentwrap">
        <ul class="tab">
            <li id="li_GLM" class="li current" onclick="toGLM()"><span>GLM</span></li>
            <li id="li_GPT" class="li" onclick="toGPT()"><span>GPT</span></li>
            <li id="li_SD" class="li" onclick="toSD()"><span>StableDiffusion</span></li>
            <li id="li_WIG" class="li" onclick="toWIG()"><span>Widgets</span></li>
        </ul>

        <div class="dialogbox_container" id="DeaftBox">
            <div class="content">
                {% for history in historys %}
                {% if loop.last  == True %}
                    <div class="item item-right"><div class="bubble bubble-right">{{history[0]}}</div><div class="avatar"><i class="fa fa-user-circle"></i></div></div>
                    <div class="item item-left"><div class="avatar"><i class="fa fa-user-circle-o"></i></div><div class="bubble bubble-left"><p id="text" data-text="{{history[1] |safe}}"></div></div>
                {% else %}
                    <div class="item item-right"><div class="bubble bubble-right">{{history[0]}}</div><div class="avatar"><i class="fa fa-user-circle"></i></div></div>
                    <div class="item item-left"><div class="avatar"><i class="fa fa-user-circle-o"></i></div><div class="bubble bubble-left" >{{ history[1] |safe}}</div></div>
                {% endif %}
                {% endfor %}
            </div>
            <div class="input-area">
                <form href="/llm" method="POST">
                    <input name="inputInfo">
                    <button onclick="startSpeechRecognition()">开始语音识别</button>
                    <p id="transcript"></p >
                    <div class="button-area">
                        <button type="submit" id="send-btn" onclick="send()">发 送</button>
                    </div>
                </form>
                <iframe src="/" style="display: none;" name="GLM"></iframe>
            </div>
        </div>

        <div id="SecndBox" style="display: none;">
            <h1>ChatGPT Demo</h1>
            <div id="chat-output"></div>
            <form id="OpenAI">
                <input type="text" id="user-input" name="user-input" />
                <input type="text" id="model-input" name="model-input" value="chatglm2-6b" />
                <button type="submit" id="sendInput">Send</button>
            </form>
        </div>

        <div id="StbleBox" style="display: none;">
            <iframe allow="autoplay *; encrypted-media *;" style="height:100vh;width:100%;overflow:hidden;background:transparent;"  src="http://127.0.0.1:7860"></iframe>
        </div>

        <div id="WidgtBox" style="display: none">
            <div class="card_container" style="height: 100vh -10px;">
                <a href="#">
                    <div class="card_contentbox">
                        <h2>小组件</h2>
                        <p>敬请期待</p>
                    </div>
                </a>
                
            </div>
        </div>

	</div>
</div>

<div class="account" id="account-box" style="display: none;">
    <div style="margin-left:20px">
        <table>
            <thead>
                <tr>
                    <th>
                        <center>
                        <h3>模型账号管理</h3>                            
                        </center>

                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <p>模型类型</p>
                    </td>
                    <td>
                        <p>模型名称</p>
                    </td>
                    <td>
                        <p>调用地址</p>
                    </td>
                    <td>
                        <p>访问密钥</p>
                    </td>
                    <td>
                        <p>编译地址</p>
                    </td>
                    <td>
                        <p>启动地址</p>
                    </td>
                    <td>
                        <p>编辑</p>
                    </td>
                    <td>
                        <p>删除</p>
                    </td>
                    <td>
                        <p>启动</p>
                    </td>
                </tr>
                {% for Model in ModelList %}
                <form action="/exchange" method="post">
                    <input type="hidden" name="{{ Model[0] }}state" id="{{ Model[0] }}state">
                    <input type="hidden" name="id" id="number" value={{ Model[0] }}>
                    <tr>
                        <td>
                            <select name="type">
                                <option>{{ Model[1] }}</option>
                                <option>OpenAI</option>
                                <option>WebUI</option>
                                <option>API</option>
                            </select>
                        </td>
                        <td> 
                            <input type="text" name="comment" placeholder="ChatGLM" value={{ Model[2] }}>
                        </td>
                        <td>
                            <input type="text" class="url" name="url" placeholder="127.0.0.1:8000" value={{ Model[3] }}>
                        </td>
                        <td>
                            <input type="text" class="url" name="APIkey" placeholder="sk-qwdjqfooajkash & none" value={{ Model[4] }}>
                        </td>
                        <td>
                            <input type="TEXT" class="url" name="LcCompiler" placeholder=".\venv\python.exe & OpenAI" value={{ Model[5] }}>
                        </td>
                        <td>
                            <input type="TEXT" class="url" name="LCurl" placeholder=".\ChatGLM\launch.py" value={{ Model[6] }}>
                        </td>
                        <td>
                            <button type="submit" style="background-color: rgba(89, 147, 255, 0.671);border-radius:20px;" type="launch" name="edit" id="edit" onclick="$('#{{ Model[0] }}state').val('edit')">编辑</button>
                        </td>
                        <td>
                            <button type="submit" style="background-color: rgba(255, 89, 89, 0.671);border-radius:20px;" type="launch" name="del" id="del" onclick="$('#{{ Model[0] }}state').val('del')">删除</button>
                        </td>
                        <td>
                            <button type="submit" style="background-color: rgba(117, 255, 89, 0.671);border-radius:20px;" type="launch" name="run" id="run" onclick="$('#{{ Model[0] }}state').val('run')">启动</button>
                        </td>
                    </tr>
                </form>
                {% endfor %}
                <form action="/exchange" method="post" target="exchange">
                    <input type="hidden" name="state" id="state">
                    <input type="hidden" name="id" id="number" value="-1">
                    <tr>
                        <td>
                            <select name="type">
                                <option>OpenAI</option>
                                <option>WebUI</option>
                                <option>API</option>
                            </select>
                        </td>
                        <td> 
                            <input type="text" name="comment" placeholder="ChatGLM">
                        </td>
                        <td>
                            <input type="text" class="url" name="url" placeholder="127.0.0.1:8000">
                        </td>
                        <td>
                            <input rtpe="text" class="url" name="APIkey" placeholder="sk-ahsjfidajfuahfhla & none">
                        </td>
                        <td>
                            <input type="TEXT" class="url" name="LcCompiler" placeholder=".\ChatGLM\scripts\python.exe">
                        </td>
                        <td>
                            <input type="TEXT" class="url" name="LCurl" placeholder=".\ChatGLM\launch.py">
                        </td>
                        <td>
                            <button disabled type="submit" style="background-color: rgba(89, 147, 255, 0.671);border-radius:20px;" name="edit" id="edit">编辑</button>
                        </td>
                        <td>
                            <button disabled type="submit" style="background-color: rgba(255, 89, 89, 0.671);border-radius:20px;" name="del" id="del">删除</button>
                        </td>
                        <td>
                            <button action="/exchange" type="submit" style="background-color: rgba(117, 255, 89, 0.671);border-radius:20px;" name="launch" id="launch">添加</button>
                        </td>
                    </tr>
                    </form>
            </thead>
        </table>
    </div>
</div>

<div class="widgets" id="widgets-box" style="display: none;">
    <div class="card_container">
        <a href="#">
            <div class="card_contentbox">
                <h2>小组件</h2>
                <p>Coming Soon!</p>
            </div>
        </a>

        <a href="#">
            <div class="card_contentbox">
                <h2>小组件</h2>
                <p>Coming Soon!</p>
            </div>
        </a>

        <a href="#">
            <div class="card_contentbox">
                <h2>小组件</h2>
                <p>Coming Soon!</p>
            </div>
        </a>

        <a href="#">
            <div class="card_contentbox">
                <h2>小组件</h2>
                <p>Coming Soon!</p>
            </div>
        </a>

        <a href="#">
            <div class="card_contentbox">
                <h2>小组件</h2>
                <p>Coming Soon!</p>
            </div>
        </a>
    </div>
</div>

<div class="models" id="models-box" style="display: none;">
    <div class="card_container">
        <a href="https://github.com/THUDM/ChatGLM-6B">
            <div class="card_contentbox">
                    <h2>ChatGLM-6B</h2>
                    <p>ChatGLM-6B 是一个开源的、支持中英双语的对话语言模型。更多信息请点击本链接</p>
            </div>
        </a>

        <a href="https://www.openai.com/">
            <div class="card_contentbox">
                <h2>ChatGPT</h2>
                <p>ChatGPT是由OpenAI开发的大型语言模型,用于进行自然语言交互。更多信息请点击本链接</p>
            </div>
        </a>

        <a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui">
            <div class="card_contentbox">
                <h2>StableDiffusion</h2>
                <p>Stable Diffusion是一种潜在扩散模型,能够从文本描述中生成详细的图像。更多信息请点击本链接</p>
            </div>
        </a>
    </div>
</div>

<div class="settings" id="setting-box" style="display: none;">
    <div style="margin-left:20px">
        <hr class="line">
        <table>
            <thead>
                <tr>
                    <th>
                        <h3>远程设置</h3>
                    </th>
                    <th>
                        <h3>Remote Setting</h3>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <p>iPv4地址</p>
                    </td>
                    <td>
                        <input type="url" name="iPv4" placeholder="127.0.0.1" value={{ host }}>
                    </td>
                </tr>
                <tr>
                    <td>
                        <p>端口</p>
                    </td>
                    <td>
                        <input type="number" name="Port" placeholder="5000" value={{ port }}>
                    </td>
                </tr>
            </thead>
        </table>
        <hr class="line">
        <table>
            <thead>
                <tr>
                    <th>
                        <h3>开发者设置  </h3>
                    </th>
                    <th>
                        <h3>Developer Settings</h3>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <p>Web模式</p>
                    </td>
                    <td>
                        <input type="text" name="Mode" placeholder="False" value={{ Mode }}>
                    </td>
                </tr>
                <tr>
                    <td>
                        <p>DeBug模式</p>
                    </td>
                    <td>
                        <input type="text" name="BugM" placeholder="False" value={{ BugM }}>
                    </td>
                </tr>
            </thead>
        </table>
        <hr class="line">
    </div>
</div>

<div class="login-container" id="login-box" style="display: none;">
    <div class="login-form-container sign-up-container" id="SignUp">
        <form action="/login" method="POST" id="SignUpDiv">
                <h1>注册</h1>           
                <div class="txtb">
                    <input name="reg_txt" type="reg_text">
                    <span data-placeholder="Useranme" ></span>
                </div>
                <div class="txtb">
                    <input name="email" type="reg_email">
                    <span data-placeholder="Email" ></span>
                </div> 
                <div class="txtb">
                    <input name="set_password" type="reg_set_password">
                    <span data-placeholder="Password" ></span>
                </div>
                <div class="txtb">
                    <input name="check_password" type="reg_check_password">
                    <span data-placeholder="Confirm Password" ></span>
                </div>            
                <button type="button" herf="/register">注册</button>
                <p onclick="CloseLogin()" class="submit" style="margin-top: 2%;">取消</p>
        </form>

    </div>

    <div class="login-form-container sign-in-container" id="SignIn">
        <form action="/login" method="POST" id="login">
            <h1>登录</h1>
            <div class="txtb">
                <input name="logid" type="log_id">
                <span data-placeholder="Username" ></span>
            </div>
            <div class="txtb">
                <input name="password" type="log_password">
                <span data-placeholder="Password"></span>
            </div>
            <button class="submit" type="submit" value="Login" herf='/login'>登录</button>
            <p onclick="CloseLogin()" class="submit" style="margin-top: 2%;">取消</p>
        </form>
    </div>

    <div class="overlay-container">
            <div class="overlay">
                <div class="overlay-panel overlay-left">
                    <h1>已有账号？</h1>
                    <p>请使用您的账号进行登录</p>
                    <button class="ghost" id="signIn" onclick="SignIn()">登录</button>
                </div>
                <div class="overlay-panel overlay-right">
                    <h1>没有账号?</h1>
                    <p>立即注册加入我们</p>
                    <button class="ghost" id="signUp" onclick="SignUp()">注册</button>
                </div>
            </div>
    </div>
</div>

<div class="copyright" id="rights-box" style="display: none;">
    <p></p>
</div>

</body>
<script>
//打字机(常驻)
var text = document.getElementById('text').getAttribute("data-text");//获取要输出的文字
var index = 0;
var element = document.getElementById('text');//获取元素
function myprint() {
    if (index < text.length) {
        element.innerText = element.innerText + text.charAt(index);
        index++;
    } else {
        clearInterval(c);//输出完后关闭定时器
    }
}
var c = setInterval(myprint, 10);//定时器

let height = document.querySelector('.content').scrollHeight;
document.querySelector(".content").scrollTop = height;

function SignUp(){
    $("#login-box").addClass('right-panel-active')
}

function SignIn(){
    $("#login-box").removeClass('right-panel-active')
}

$(".txtb input").on("focus",function(){
    $(this).addClass("focus")
})

$(".txtb input").on("blur",function(){
    if($(this).val() == '')
    $(this).removeClass("focus")
})

</script>
{% endblock %}
{% block footer %}
{% endblock %}
</html>